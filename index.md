# Introduction

This lab is all about testing the strengths and weaknesses of a firewall. It will look at the inbound and outbound rules of a firewall for a wireless network and show how Nessus can be used to detect the early signs of a potential cyber-attack. The firewall will then be modified to counteract this threat and prevent others from occurring.

# Hands-On Demonstration

## Examine a pfSense Server Firewall Configuration

The only thing of note here is that my server's firewall configuration contains a WAN rule that exposes the server to the entire public network. This will be relevant throughout the lab.

## Social Engineering / Reverse Social Engineering Attack

### Run a basic network scan

In this step, I use Nessus to run a basic network scan of the TargetWindows01 computer. The results can be seen in the screenshot below. According to the graphs, there are a total of twelve low-to-medium vulnerabilities.

<p align="center">
  <img width="980" height="560" src="assets/fig1.png">
</p>

### Display vulnerabilities

This step expands upon the previous one. All of the scanned vulnerabilities are displayed along with their threat levels and a description of each.

<p align="center">
  <img width="980" height="560" src="assets/fig2.png">
</p>

### Run another scan after changing firewall rules

After seeing all the vulnerabilities, I then went back to the firewall control panel and deleted the WAN and LAN rules that allowed incoming connections to pass through. As a result, the machine is totally blocked off from the public network and, in turn, has no vulnerabilities.

<p align="center">
  <img width="980" height="560" src="assets/fig3.png">
</p>

# Applied Learning

## Examine a pfSense Firewall Configuration

### Create a new LAN rule for MS RDP (3389)

Going back to the LAN page in pfSense, I created a new LAN rule that allows Remote Desktop Protocol (MS RDP (3389)) to pass to the destination. In addition, any packets that are handled by this rule are logged. The new rule can be seen at the bottom. (NOTE: I had to restart the lab in order to get the two rules I deleted back).

<p align="center">
  <img width="980" height="560" src="assets/fig4.png">
</p>

## Conduct Penetration Testing on the Network

### Run a network scan on TargetWindows02 with the new LAN rule

With the new LAN rule in place, I open a remote connection to TargetWindows02 and run another scan with Nessus. The screenshot below shows the resulting vulnerability report. Notice that in addition to the low-to-medium level threats, there is now a critical threat.

<p align="center">
  <img width="980" height="560" src="assets/fig5.png">
</p>

### Expand upon the critical vulnerability

In this step, the critical vulnerability is selected from the vulnerability report and its description and potential solution are displayed.

<p align="center">
  <img width="980" height="560" src="assets/fig6.png">
</p>

<p align="center">
  <img width="980" height="560" src="assets/fig7.png">
</p>

### Run a scan with Zenmap to identify open ports

This step introduces the program Zenmap which uses a SYN scan to identify any open ports. The screenshot below shows the result of this scan including the server’s open ports. There are quite a few open ports and the Nessus scan defines this as a danger because a specially-crafted attack packet can be used to penetrate the firewall. 

<p align="center">
  <img width="980" height="560" src="assets/fig8.png">
</p>

### Delete unnecessary rules to reduce risk

In this step, the WAN rule that allows incoming connections to pass the firewall has been deleted. In addition, any LAN rules that allow traffic to access the ports than aren’t listed as “open” in the Zenmap scan. The screenshot shows the reduced LAN rule list.

<p align="center">
  <img width="980" height="560" src="assets/fig9.png">
</p>

# Lab Challenge and Analysis

## Discussing Remediation Techniques Based off WannaCry

The WannaCry ransomware attack affects the TCP 445, 137, 139, and UDP 137 and 138. As its poor traffic handling techniques can be exploited with a specially crafted attack packet. The recommended solution is to download a set of patches for your corresponding Windows operating system. If you do not have an OS with the fix, you are advised to remove SMBv1 completely. It is important to perform routine penetration testing on networks and individual servers in order to ensure the firewall is not susceptible to any vulnerabilities or exploits.

## Tools and Commands

Below is a screenshot of a quick scan from Zenmap that adds the ICMP Ping option. This scan shows only the DNS (53), HTTP (80), and MS RDP (3389) ports being open.

<p align="center">
  <img width="980" height="560" src="assets/fig10.png">
</p>

## Firewall Vulnerability Mitigation, Before and After

In this final section, I demonstrate a vulnerability scan before and after I apply mitigation techniques, such as disabling insecure ports.

<p align="center">
  <img width="980" height="560" src="assets/fig11.png">
</p>

[Before](file:///C:/Users/matt9/AppData/Local/Temp/%7BBB593864-249F-4C3B-80DA-04E0232C06EE%7D/%7B818F8D8A-C7BD-48CD-B5BC-4FA28BC4C75C%7D/Matthew_Bice_pen_test_s2_z4m4hk(first).html)

[After](file:///C:/Users/matt9/AppData/Local/Temp/%7BBB593864-249F-4C3B-80DA-04E0232C06EE%7D/%7B3B5FE8F9-5E8E-48D9-B32B-C6355E019DAE%7D/Matthew_Bice_pen_test_s2_bs3g7f(final).html)
